import{r as e,j as s}from"./ui-DlaF13aT.js";import{ad as t,a2 as a,B as i,ae as l,f as r,a7 as n,d as c,m as o,I as d,O as m,q as x,r as h,s as u,t as g}from"./index-Bz8mWo3A.js";import{B as j}from"./badge-Yxso3t7Q.js";import{S as p}from"./skeleton-CGXdJABU.js";import{T as b,a as v,b as N,c as f}from"./tabs-BpRHwVmU.js";import{M as w}from"./MarkdownRenderer-CelGe7d4.js";import{B as y,I as k,C as S,Q as C,L as _,a as F}from"./quote-D-aRUu8L.js";import{L as E}from"./link-1jMZnk74.js";import{I as B}from"./image-DgWl23az.js";import{C as z}from"./circle-check-big-DxDlI_ih.js";import{S as I}from"./settings-BHTTpk_R.js";import{Z as V}from"./zap-BCTdAC6d.js";import{P as $}from"./plus-8wPMdtHD.js";import{E as q}from"./eye-CwmidPN2.js";import{S as H}from"./square-pen-Bw_IsG40.js";import{T as D}from"./trash-2-BKaciHhd.js";import{S as L}from"./save-DPK-U3GZ.js";import"./vendor-DjPCVcPo.js";import"./charts-DCG9Wh5P.js";import"./router-CpKuIDSt.js";const G=({value:t,onChange:a,height:l=400,placeholder:r="Start writing in markdown..."})=>{const[n,c]=e.useState("write"),o=(e,s="",i="")=>{const l=document.getElementById("markdown-textarea");if(!l)return;const r=l.selectionStart,n=l.selectionEnd,c=t.substring(r,n)||i,o=t.substring(0,r)+e+c+s+t.substring(n);a(o),setTimeout(()=>{const s=r+e.length+c.length;l.setSelectionRange(s,s),l.focus()},0)},d=[{icon:y,action:()=>o("**","**","bold text"),title:"Bold"},{icon:k,action:()=>o("*","*","italic text"),title:"Italic"},{icon:S,action:()=>o("`","`","code"),title:"Inline Code"},{icon:C,action:()=>o("> ","","quote"),title:"Quote"},{icon:_,action:()=>o("- ","","list item"),title:"Bullet List"},{icon:F,action:()=>o("1. ","","list item"),title:"Numbered List"},{icon:E,action:()=>o("[","](url)","link text"),title:"Link"},{icon:B,action:()=>o("![","](url)","alt text"),title:"Image"}],m=e=>{const s="#".repeat(e)+" ";o(s,"",`Heading ${e}`)};return s.jsx("div",{className:"border border-gray-200 rounded-lg overflow-hidden",children:s.jsxs(b,{value:n,onValueChange:c,children:[s.jsx("div",{className:"border-b border-gray-200 bg-gray-50 p-2",children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{className:"flex items-center gap-1",children:[s.jsx(i,{variant:"ghost",size:"sm",onClick:()=>m(1),title:"Heading 1",className:"text-xs",children:"H1"}),s.jsx(i,{variant:"ghost",size:"sm",onClick:()=>m(2),title:"Heading 2",className:"text-xs",children:"H2"}),s.jsx(i,{variant:"ghost",size:"sm",onClick:()=>m(3),title:"Heading 3",className:"text-xs",children:"H3"}),s.jsx("div",{className:"w-px h-6 bg-gray-300 mx-2"}),d.map((e,t)=>s.jsx(i,{variant:"ghost",size:"sm",onClick:e.action,title:e.title,children:s.jsx(e.icon,{className:"h-4 w-4"})},t))]}),s.jsxs(v,{className:"grid grid-cols-2 w-32",children:[s.jsx(N,{value:"write",className:"text-xs",children:"Write"}),s.jsx(N,{value:"preview",className:"text-xs",children:"Preview"})]})]})}),s.jsx(f,{value:"write",className:"m-0",children:s.jsx("textarea",{id:"markdown-textarea",value:t,onChange:e=>a(e.target.value),placeholder:r,className:"w-full p-4 border-0 outline-none resize-none font-mono text-sm leading-relaxed",style:{height:`${l}px`}})}),s.jsx(f,{value:"preview",className:"m-0",children:s.jsx("div",{className:"p-4 overflow-auto",style:{height:`${l}px`},children:t?s.jsx(w,{content:t}):s.jsx("div",{className:"text-gray-500 italic",children:"Nothing to preview yet. Start writing in the Write tab."})})})]})})};function M(){const{isAuthenticated:b}=t(),v=function(){const{username:e,password:s,isAuthenticated:i}=t();if(!i||!e||!s)return a;const l=btoa(`${e}:${s}`);return a.with({auth:{authorization:`Basic ${l}`}})}(),[N,f]=e.useState("queue"),[w,y]=e.useState(!1),[k,S]=e.useState([]),[C,F]=e.useState([]),[E,B]=e.useState(null),[M,P]=e.useState(null),[T,A]=e.useState(""),[O,Q]=e.useState(!1),[R,W]=e.useState({remaining:0,completed:0,total:0}),[U,Z]=e.useState(null),[J,K]=e.useState(null),[Y,X]=e.useState({title:"",meta_title:"",meta_desc:"",content_md:"",keywords:[]}),[ee,se]=e.useState(!1);e.useEffect(()=>{b&&(ae(),te())},[b,N]);const te=async()=>{try{const e=await v.blogV2.getProgress();W(e)}catch(e){console.error("Failed to load progress",e)}},ae=async()=>{"queue"===N?await ie():"published"===N?await le():"settings"===N&&await re()},ie=async()=>{try{y(!0);const e=await v.blogV2.listUnbloggedSources({limit:100});S(e.sources)}catch(e){l({title:"Error",description:e.message||"Failed to load unblogged sources",variant:"destructive"})}finally{y(!1)}},le=async()=>{try{y(!0);const e=await v.blogV2.list({status:"PUBLISHED",page:1,limit:100});F(e.blogs)}catch(e){l({title:"Error",description:e.message||"Failed to load published blogs",variant:"destructive"})}finally{y(!1)}},re=async()=>{try{y(!0);const e=await v.blogV2.getSettings();B(e)}catch(e){l({title:"Error",description:e.message||"Failed to load settings",variant:"destructive"})}finally{y(!1)}},ne=async e=>{try{P(e);const s=await v.blogV2.generate({source_url:e});l({title:"Success",description:`Blog generated: ${s.blog.title}`}),await ae(),await te()}catch(s){l({title:"Error",description:s.message||"Failed to generate blog",variant:"destructive"})}finally{P(null)}},ce=()=>{K(null),X({title:"",meta_title:"",meta_desc:"",content_md:"",keywords:[]})};return b?s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("h1",{className:"text-3xl font-bold",children:"Blog Management v2"}),s.jsxs("div",{className:"flex gap-2",children:[s.jsxs(i,{onClick:te,variant:"outline",size:"sm",children:[s.jsx(n,{className:"w-4 h-4 mr-2"}),"Refresh"]}),s.jsxs(i,{onClick:async()=>{try{y(!0);const e=await v.sources.discover();l({title:"Success",description:`Discovered ${e.discovered} sources, ${e.new_sources} new`}),await ie()}catch(e){l({title:"Error",description:e.message||"Failed to discover sources",variant:"destructive"})}finally{y(!1)}},disabled:w,variant:"outline",children:[s.jsx(n,{className:"w-4 h-4 mr-2"}),"Discover Sources"]})]})]}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[s.jsx(r,{className:"p-6 bg-gradient-to-br from-green-50 to-emerald-50 border-green-200",children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsx("p",{className:"text-sm font-medium text-green-700",children:"âœ… Completed"}),s.jsx("p",{className:"text-3xl font-bold text-green-900",children:R.completed})]}),s.jsx(z,{className:"w-10 h-10 text-green-600 opacity-50"})]})}),s.jsx(r,{className:"p-6 bg-gradient-to-br from-orange-50 to-amber-50 border-orange-200",children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsx("p",{className:"text-sm font-medium text-orange-700",children:"ðŸ•’ Waiting"}),s.jsx("p",{className:"text-3xl font-bold text-orange-900",children:R.remaining})]}),s.jsx(c,{className:"w-10 h-10 text-orange-600 opacity-50"})]})}),s.jsx(r,{className:"p-6 bg-gradient-to-br from-blue-50 to-indigo-50 border-blue-200",children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsx("p",{className:"text-sm font-medium text-blue-700",children:"ðŸ“Š Total"}),s.jsx("p",{className:"text-3xl font-bold text-blue-900",children:R.total})]}),s.jsx(_,{className:"w-10 h-10 text-blue-600 opacity-50"})]})})]}),U&&s.jsx(r,{className:"p-4 bg-green-50 border-green-200",children:s.jsxs("p",{className:"text-green-800 font-medium",children:["âœ… Last Created: ",s.jsx("span",{className:"font-bold",children:U})]})}),s.jsxs("div",{className:"flex gap-2 border-b",children:[s.jsxs("button",{onClick:()=>f("queue"),className:"px-4 py-2 font-medium "+("queue"===N?"border-b-2 border-blue-500 text-blue-600":"text-slate-600"),children:[s.jsx(_,{className:"w-4 h-4 inline mr-2"}),"Queue (",k.length,")"]}),s.jsxs("button",{onClick:()=>f("published"),className:"px-4 py-2 font-medium "+("published"===N?"border-b-2 border-blue-500 text-blue-600":"text-slate-600"),children:[s.jsx(z,{className:"w-4 h-4 inline mr-2"}),"Published (",C.length,")"]}),s.jsxs("button",{onClick:()=>f("settings"),className:"px-4 py-2 font-medium "+("settings"===N?"border-b-2 border-blue-500 text-blue-600":"text-slate-600"),children:[s.jsx(I,{className:"w-4 h-4 inline mr-2"}),"Settings"]})]}),"queue"===N&&s.jsxs("div",{className:"space-y-4",children:[s.jsx(r,{className:"p-6 bg-gradient-to-r from-purple-50 to-pink-50 border-purple-200",children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsx("h3",{className:"font-bold text-xl text-purple-900 mb-2",children:"âš¡ Quick Generate"}),s.jsx("p",{className:"text-sm text-purple-700",children:"Generate a blog post for the next pending page in one click"})]}),s.jsx(i,{onClick:async()=>{try{Q(!0),Z(null);const e=await v.blogV2.generateNow();e.success?(l({title:"âœ… Blog Created Successfully!",description:`Created: ${e.title}`}),Z(e.title||null)):l({title:"Info",description:e.message,variant:0===e.remaining?"default":"destructive"}),W({remaining:e.remaining,completed:e.completed,total:e.remaining+e.completed}),await ae()}catch(e){l({title:"Error",description:e.message||"Failed to generate blog",variant:"destructive"})}finally{Q(!1)}},disabled:O||0===R.remaining,size:"lg",className:"bg-gradient-to-r from-purple-600 to-pink-600 hover:from-purple-700 hover:to-pink-700",children:O?s.jsxs(s.Fragment,{children:[s.jsx(o,{className:"w-5 h-5 mr-2 animate-spin"}),"Generating..."]}):s.jsxs(s.Fragment,{children:[s.jsx(V,{className:"w-5 h-5 mr-2"}),"Generate Now"]})})]})}),s.jsxs(r,{className:"p-6",children:[s.jsx("h3",{className:"font-bold mb-4",children:"Generate Blog Manually"}),s.jsxs("div",{className:"flex gap-2",children:[s.jsx(d,{placeholder:"Enter source URL (e.g., /calculator/bmi)",value:T,onChange:e=>A(e.target.value)}),s.jsxs(i,{onClick:()=>{T&&(ne(T),A(""))},disabled:!T||!!M,children:[s.jsx($,{className:"w-4 h-4 mr-2"}),"Generate Now"]})]})]}),w?s.jsx("div",{className:"space-y-2",children:[...Array(5)].map((e,t)=>s.jsx(p,{className:"h-20 w-full"},t))}):s.jsxs("div",{className:"space-y-2",children:[k.map(e=>s.jsx(r,{className:"p-4",children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{className:"flex-1",children:[s.jsx("h4",{className:"font-medium",children:e.title||e.source_url}),s.jsx("p",{className:"text-sm text-slate-500",children:e.source_url}),s.jsx(j,{variant:"outline",className:"mt-1",children:e.kind})]}),s.jsx(i,{onClick:()=>ne(e.source_url),disabled:M===e.source_url,size:"sm",children:M===e.source_url?s.jsxs(s.Fragment,{children:[s.jsx(o,{className:"w-4 h-4 mr-2 animate-spin"}),"Generating..."]}):s.jsxs(s.Fragment,{children:[s.jsx($,{className:"w-4 h-4 mr-2"}),"Generate"]})})]})},e.id)),0===k.length&&s.jsx(r,{className:"p-12 text-center",children:s.jsx("p",{className:"text-slate-600",children:"All sources have been blogged!"})})]})]}),"published"===N&&s.jsx("div",{className:"space-y-2",children:w?s.jsx("div",{className:"space-y-2",children:[...Array(5)].map((e,t)=>s.jsx(p,{className:"h-24 w-full"},t))}):s.jsxs(s.Fragment,{children:[C.map(e=>s.jsx(r,{className:"p-4",children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{className:"flex-1",children:[s.jsx("h4",{className:"font-medium",children:e.title}),s.jsxs("p",{className:"text-sm text-slate-500",children:["/blog/",e.slug]}),s.jsxs("div",{className:"flex gap-2 mt-2",children:[s.jsx(j,{children:e.status}),s.jsx(j,{variant:"outline",children:e.kind}),e.published_at&&s.jsx("span",{className:"text-xs text-slate-500",children:new Date(e.published_at).toLocaleDateString()})]})]}),s.jsxs("div",{className:"flex gap-2",children:[s.jsx(i,{variant:"outline",size:"sm",onClick:()=>window.open(`/blog/${e.slug}`,"_blank"),children:s.jsx(q,{className:"w-4 h-4"})}),s.jsx(i,{variant:"outline",size:"sm",onClick:()=>(e=>{K(e),X({title:e.title,meta_title:e.meta_title||"",meta_desc:e.meta_desc||"",content_md:e.content_md,keywords:e.keywords||[]})})(e),children:s.jsx(H,{className:"w-4 h-4"})}),s.jsx(i,{variant:"destructive",size:"sm",onClick:()=>(async e=>{if(confirm("Are you sure you want to delete this blog?"))try{await v.blogV2.deleteBlog({blog_id:e}),l({title:"Success",description:"Blog deleted"}),await ae(),await te()}catch(s){l({title:"Error",description:s.message||"Failed to delete blog",variant:"destructive"})}})(e.id),children:s.jsx(D,{className:"w-4 h-4"})})]})]})},e.id)),0===C.length&&s.jsx(r,{className:"p-12 text-center",children:s.jsx("p",{className:"text-slate-600",children:"No published blogs yet"})})]})}),"settings"===N&&E&&s.jsxs(r,{className:"p-6 space-y-6",children:[s.jsxs("div",{children:[s.jsx(m,{children:"Default Tone"}),s.jsx(d,{value:E.default_tone,onChange:e=>B({...E,default_tone:e.target.value})})]}),s.jsxs("div",{children:[s.jsx(m,{children:"Default Model"}),s.jsx(d,{value:E.default_model,onChange:e=>B({...E,default_model:e.target.value})})]}),s.jsxs("div",{children:[s.jsx(m,{children:"Schedule Hour (Sydney time)"}),s.jsx(d,{type:"number",min:"0",max:"23",value:E.schedule_hour,onChange:e=>B({...E,schedule_hour:parseInt(e.target.value)})})]}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("input",{type:"checkbox",id:"enabled",checked:E.enabled,onChange:e=>B({...E,enabled:e.target.checked})}),s.jsx(m,{htmlFor:"enabled",children:"Enable Daily Cron Job"})]}),s.jsxs(i,{onClick:()=>(async e=>{try{const s=await v.blogV2.updateSettings(e);B(s),l({title:"Success",description:"Settings updated"})}catch(s){l({title:"Error",description:s.message||"Failed to update settings",variant:"destructive"})}})(E),children:[s.jsx(z,{className:"w-4 h-4 mr-2"}),"Save Settings"]})]}),s.jsx(x,{open:!!J,onOpenChange:e=>!e&&ce(),children:s.jsxs(h,{className:"max-w-4xl max-h-[90vh] overflow-y-auto",children:[s.jsx(u,{children:s.jsx(g,{children:"Edit Blog Post"})}),s.jsxs("div",{className:"space-y-6 py-4",children:[s.jsxs("div",{className:"space-y-2",children:[s.jsx(m,{htmlFor:"edit-title",children:"Title"}),s.jsx(d,{id:"edit-title",value:Y.title,onChange:e=>X({...Y,title:e.target.value}),placeholder:"Blog title"})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx(m,{htmlFor:"edit-meta-title",children:"Meta Title (SEO)"}),s.jsx(d,{id:"edit-meta-title",value:Y.meta_title,onChange:e=>X({...Y,meta_title:e.target.value}),placeholder:"SEO meta title"})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx(m,{htmlFor:"edit-meta-desc",children:"Meta Description (SEO)"}),s.jsx(d,{id:"edit-meta-desc",value:Y.meta_desc,onChange:e=>X({...Y,meta_desc:e.target.value}),placeholder:"SEO meta description"})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx(m,{htmlFor:"edit-keywords",children:"Keywords (comma-separated)"}),s.jsx(d,{id:"edit-keywords",value:Y.keywords.join(", "),onChange:e=>X({...Y,keywords:e.target.value.split(",").map(e=>e.trim()).filter(Boolean)}),placeholder:"keyword1, keyword2, keyword3"})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx(m,{children:"Content (Markdown)"}),s.jsx(G,{value:Y.content_md,onChange:e=>X({...Y,content_md:e}),height:500,placeholder:"Write your blog content in markdown..."})]}),s.jsxs("div",{className:"flex gap-2 justify-end",children:[s.jsx(i,{variant:"outline",onClick:ce,disabled:ee,children:"Cancel"}),s.jsx(i,{onClick:async()=>{if(J)try{se(!0),await v.blogV2.update({blog_id:J.id,title:Y.title,meta_title:Y.meta_title,meta_desc:Y.meta_desc,content_md:Y.content_md,keywords:Y.keywords}),l({title:"Success",description:"Blog updated successfully"}),ce(),await le()}catch(e){l({title:"Error",description:e.message||"Failed to update blog",variant:"destructive"})}finally{se(!1)}},disabled:ee,children:ee?s.jsxs(s.Fragment,{children:[s.jsx(o,{className:"w-4 h-4 mr-2 animate-spin"}),"Saving..."]}):s.jsxs(s.Fragment,{children:[s.jsx(L,{className:"w-4 h-4 mr-2"}),"Save Changes"]})})]})]})]})})]}):s.jsx(r,{className:"p-6",children:s.jsx("p",{className:"text-center text-slate-600",children:"Please log in to access blog management"})})}export{M as default};
