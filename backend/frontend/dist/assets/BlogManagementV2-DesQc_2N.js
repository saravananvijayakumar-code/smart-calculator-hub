import{j as e}from"./ui-vendor-CXejv-Vd.js";import{r as s}from"./react-vendor-CHV_IW2N.js";import{y as t,t as a,B as l,z as i,a as n,I as r,L as c,D as d,g as o,h as m,i as x}from"./index-Cr6N7EBb.js";import{B as h}from"./badge-BR8KeZ6e.js";import{S as u}from"./skeleton-BPRa1hMq.js";import{T as g,a as j,b as p,c as b}from"./tabs-kE7gD3tv.js";import{M as v}from"./MarkdownRenderer-Lw0kgnVa.js";import{bp as N,bq as w,br as y,bs as f,bt as k,bu as S,ax as _,bv as C,R as F,w as E,g as B,bw as z,o as V,Z as $,aJ as D,aO as H,V as G,P as I,ai as L}from"./utils-vendor-D0ROWCy7.js";import"./charts-vendor-CfJeLvg-.js";import"./i18n-vendor-p0y8CAKE.js";const M=({value:t,onChange:a,height:i=400,placeholder:n="Start writing in markdown..."})=>{const[r,c]=s.useState("write"),d=(e,s="",l="")=>{const i=document.getElementById("markdown-textarea");if(!i)return;const n=i.selectionStart,r=i.selectionEnd,c=t.substring(n,r)||l,d=t.substring(0,n)+e+c+s+t.substring(r);a(d),setTimeout(()=>{const s=n+e.length+c.length;i.setSelectionRange(s,s),i.focus()},0)},o=[{icon:N,action:()=>d("**","**","bold text"),title:"Bold"},{icon:w,action:()=>d("*","*","italic text"),title:"Italic"},{icon:y,action:()=>d("`","`","code"),title:"Inline Code"},{icon:f,action:()=>d("> ","","quote"),title:"Quote"},{icon:k,action:()=>d("- ","","list item"),title:"Bullet List"},{icon:S,action:()=>d("1. ","","list item"),title:"Numbered List"},{icon:_,action:()=>d("[","](url)","link text"),title:"Link"},{icon:C,action:()=>d("![","](url)","alt text"),title:"Image"}],m=e=>{const s="#".repeat(e)+" ";d(s,"",`Heading ${e}`)};return e.jsx("div",{className:"border border-gray-200 rounded-lg overflow-hidden",children:e.jsxs(g,{value:r,onValueChange:c,children:[e.jsx("div",{className:"border-b border-gray-200 bg-gray-50 p-2",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(l,{variant:"ghost",size:"sm",onClick:()=>m(1),title:"Heading 1",className:"text-xs",children:"H1"}),e.jsx(l,{variant:"ghost",size:"sm",onClick:()=>m(2),title:"Heading 2",className:"text-xs",children:"H2"}),e.jsx(l,{variant:"ghost",size:"sm",onClick:()=>m(3),title:"Heading 3",className:"text-xs",children:"H3"}),e.jsx("div",{className:"w-px h-6 bg-gray-300 mx-2"}),o.map((s,t)=>e.jsx(l,{variant:"ghost",size:"sm",onClick:s.action,title:s.title,children:e.jsx(s.icon,{className:"h-4 w-4"})},t))]}),e.jsxs(j,{className:"grid grid-cols-2 w-32",children:[e.jsx(p,{value:"write",className:"text-xs",children:"Write"}),e.jsx(p,{value:"preview",className:"text-xs",children:"Preview"})]})]})}),e.jsx(b,{value:"write",className:"m-0",children:e.jsx("textarea",{id:"markdown-textarea",value:t,onChange:e=>a(e.target.value),placeholder:n,className:"w-full p-4 border-0 outline-none resize-none font-mono text-sm leading-relaxed",style:{height:`${i}px`}})}),e.jsx(b,{value:"preview",className:"m-0",children:e.jsx("div",{className:"p-4 overflow-auto",style:{height:`${i}px`},children:t?e.jsx(v,{content:t}):e.jsx("div",{className:"text-gray-500 italic",children:"Nothing to preview yet. Start writing in the Write tab."})})})]})})};function q(){const{isAuthenticated:g}=t(),j=function(){const{username:e,password:s,isAuthenticated:l}=t();if(!l||!e||!s)return a;const i=btoa(`${e}:${s}`);return a.with({auth:{authorization:`Basic ${i}`}})}(),[p,b]=s.useState("queue"),[v,N]=s.useState(!1),[w,y]=s.useState([]),[f,S]=s.useState([]),[_,C]=s.useState(null),[q,P]=s.useState(null),[T,A]=s.useState(""),[O,R]=s.useState(!1),[W,Q]=s.useState({remaining:0,completed:0,total:0}),[U,J]=s.useState(null),[K,Z]=s.useState(null),[X,Y]=s.useState({title:"",meta_title:"",meta_desc:"",content_md:"",keywords:[]}),[ee,se]=s.useState(!1);s.useEffect(()=>{g&&(ae(),te())},[g,p]);const te=async()=>{try{const e=await j.blogV2.getProgress();Q(e)}catch(e){console.error("Failed to load progress",e)}},ae=async()=>{"queue"===p?await le():"published"===p?await ie():"settings"===p&&await ne()},le=async()=>{try{N(!0);const e=await j.blogV2.listUnbloggedSources({limit:100});y(e.sources)}catch(e){i({title:"Error",description:e.message||"Failed to load unblogged sources",variant:"destructive"})}finally{N(!1)}},ie=async()=>{try{N(!0);const e=await j.blogV2.list({status:"PUBLISHED",page:1,limit:100});S(e.blogs)}catch(e){i({title:"Error",description:e.message||"Failed to load published blogs",variant:"destructive"})}finally{N(!1)}},ne=async()=>{try{N(!0);const e=await j.blogV2.getSettings();C(e)}catch(e){i({title:"Error",description:e.message||"Failed to load settings",variant:"destructive"})}finally{N(!1)}},re=async e=>{try{P(e);const s=await j.blogV2.generate({source_url:e});i({title:"Success",description:`Blog generated: ${s.blog.title}`}),await ae(),await te()}catch(s){i({title:"Error",description:s.message||"Failed to generate blog",variant:"destructive"})}finally{P(null)}},ce=()=>{Z(null),Y({title:"",meta_title:"",meta_desc:"",content_md:"",keywords:[]})};return g?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Blog Management v2"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(l,{onClick:te,variant:"outline",size:"sm",children:[e.jsx(F,{className:"w-4 h-4 mr-2"}),"Refresh"]}),e.jsxs(l,{onClick:async()=>{try{N(!0);const e=await j.sources.discover();i({title:"Success",description:`Discovered ${e.discovered} sources, ${e.new_sources} new`}),await le()}catch(e){i({title:"Error",description:e.message||"Failed to discover sources",variant:"destructive"})}finally{N(!1)}},disabled:v,variant:"outline",children:[e.jsx(F,{className:"w-4 h-4 mr-2"}),"Discover Sources"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx(n,{className:"p-6 bg-gradient-to-br from-green-50 to-emerald-50 border-green-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-green-700",children:"âœ… Completed"}),e.jsx("p",{className:"text-3xl font-bold text-green-900",children:W.completed})]}),e.jsx(E,{className:"w-10 h-10 text-green-600 opacity-50"})]})}),e.jsx(n,{className:"p-6 bg-gradient-to-br from-orange-50 to-amber-50 border-orange-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-orange-700",children:"ðŸ•’ Waiting"}),e.jsx("p",{className:"text-3xl font-bold text-orange-900",children:W.remaining})]}),e.jsx(B,{className:"w-10 h-10 text-orange-600 opacity-50"})]})}),e.jsx(n,{className:"p-6 bg-gradient-to-br from-blue-50 to-indigo-50 border-blue-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-blue-700",children:"ðŸ“Š Total"}),e.jsx("p",{className:"text-3xl font-bold text-blue-900",children:W.total})]}),e.jsx(k,{className:"w-10 h-10 text-blue-600 opacity-50"})]})})]}),U&&e.jsx(n,{className:"p-4 bg-green-50 border-green-200",children:e.jsxs("p",{className:"text-green-800 font-medium",children:["âœ… Last Created: ",e.jsx("span",{className:"font-bold",children:U})]})}),e.jsxs("div",{className:"flex gap-2 border-b",children:[e.jsxs("button",{onClick:()=>b("queue"),className:"px-4 py-2 font-medium "+("queue"===p?"border-b-2 border-blue-500 text-blue-600":"text-slate-600"),children:[e.jsx(k,{className:"w-4 h-4 inline mr-2"}),"Queue (",w.length,")"]}),e.jsxs("button",{onClick:()=>b("published"),className:"px-4 py-2 font-medium "+("published"===p?"border-b-2 border-blue-500 text-blue-600":"text-slate-600"),children:[e.jsx(E,{className:"w-4 h-4 inline mr-2"}),"Published (",f.length,")"]}),e.jsxs("button",{onClick:()=>b("settings"),className:"px-4 py-2 font-medium "+("settings"===p?"border-b-2 border-blue-500 text-blue-600":"text-slate-600"),children:[e.jsx(z,{className:"w-4 h-4 inline mr-2"}),"Settings"]})]}),"queue"===p&&e.jsxs("div",{className:"space-y-4",children:[e.jsx(n,{className:"p-6 bg-gradient-to-r from-purple-50 to-pink-50 border-purple-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-xl text-purple-900 mb-2",children:"âš¡ Quick Generate"}),e.jsx("p",{className:"text-sm text-purple-700",children:"Generate a blog post for the next pending page in one click"})]}),e.jsx(l,{onClick:async()=>{try{R(!0),J(null);const e=await j.blogV2.generateNow();e.success?(i({title:"âœ… Blog Created Successfully!",description:`Created: ${e.title}`}),J(e.title||null)):i({title:"Info",description:e.message,variant:0===e.remaining?"default":"destructive"}),Q({remaining:e.remaining,completed:e.completed,total:e.remaining+e.completed}),await ae()}catch(e){i({title:"Error",description:e.message||"Failed to generate blog",variant:"destructive"})}finally{R(!1)}},disabled:O||0===W.remaining,size:"lg",className:"bg-gradient-to-r from-purple-600 to-pink-600 hover:from-purple-700 hover:to-pink-700",children:O?e.jsxs(e.Fragment,{children:[e.jsx(V,{className:"w-5 h-5 mr-2 animate-spin"}),"Generating..."]}):e.jsxs(e.Fragment,{children:[e.jsx($,{className:"w-5 h-5 mr-2"}),"Generate Now"]})})]})}),e.jsxs(n,{className:"p-6",children:[e.jsx("h3",{className:"font-bold mb-4",children:"Generate Blog Manually"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(r,{placeholder:"Enter source URL (e.g., /calculator/bmi)",value:T,onChange:e=>A(e.target.value)}),e.jsxs(l,{onClick:()=>{T&&(re(T),A(""))},disabled:!T||!!q,children:[e.jsx(D,{className:"w-4 h-4 mr-2"}),"Generate Now"]})]})]}),v?e.jsx("div",{className:"space-y-2",children:[...Array(5)].map((s,t)=>e.jsx(u,{className:"h-20 w-full"},t))}):e.jsxs("div",{className:"space-y-2",children:[w.map(s=>e.jsx(n,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-medium",children:s.title||s.source_url}),e.jsx("p",{className:"text-sm text-slate-500",children:s.source_url}),e.jsx(h,{variant:"outline",className:"mt-1",children:s.kind})]}),e.jsx(l,{onClick:()=>re(s.source_url),disabled:q===s.source_url,size:"sm",children:q===s.source_url?e.jsxs(e.Fragment,{children:[e.jsx(V,{className:"w-4 h-4 mr-2 animate-spin"}),"Generating..."]}):e.jsxs(e.Fragment,{children:[e.jsx(D,{className:"w-4 h-4 mr-2"}),"Generate"]})})]})},s.id)),0===w.length&&e.jsx(n,{className:"p-12 text-center",children:e.jsx("p",{className:"text-slate-600",children:"All sources have been blogged!"})})]})]}),"published"===p&&e.jsx("div",{className:"space-y-2",children:v?e.jsx("div",{className:"space-y-2",children:[...Array(5)].map((s,t)=>e.jsx(u,{className:"h-24 w-full"},t))}):e.jsxs(e.Fragment,{children:[f.map(s=>e.jsx(n,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-medium",children:s.title}),e.jsxs("p",{className:"text-sm text-slate-500",children:["/blog/",s.slug]}),e.jsxs("div",{className:"flex gap-2 mt-2",children:[e.jsx(h,{children:s.status}),e.jsx(h,{variant:"outline",children:s.kind}),s.published_at&&e.jsx("span",{className:"text-xs text-slate-500",children:new Date(s.published_at).toLocaleDateString()})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(l,{variant:"outline",size:"sm",onClick:()=>window.open(`/blog/${s.slug}`,"_blank"),children:e.jsx(H,{className:"w-4 h-4"})}),e.jsx(l,{variant:"outline",size:"sm",onClick:()=>(e=>{Z(e),Y({title:e.title,meta_title:e.meta_title||"",meta_desc:e.meta_desc||"",content_md:e.content_md,keywords:e.keywords||[]})})(s),children:e.jsx(G,{className:"w-4 h-4"})}),e.jsx(l,{variant:"destructive",size:"sm",onClick:()=>(async e=>{if(confirm("Are you sure you want to delete this blog?"))try{await j.blogV2.deleteBlog({blog_id:e}),i({title:"Success",description:"Blog deleted"}),await ae(),await te()}catch(s){i({title:"Error",description:s.message||"Failed to delete blog",variant:"destructive"})}})(s.id),children:e.jsx(I,{className:"w-4 h-4"})})]})]})},s.id)),0===f.length&&e.jsx(n,{className:"p-12 text-center",children:e.jsx("p",{className:"text-slate-600",children:"No published blogs yet"})})]})}),"settings"===p&&_&&e.jsxs(n,{className:"p-6 space-y-6",children:[e.jsxs("div",{children:[e.jsx(c,{children:"Default Tone"}),e.jsx(r,{value:_.default_tone,onChange:e=>C({..._,default_tone:e.target.value})})]}),e.jsxs("div",{children:[e.jsx(c,{children:"Default Model"}),e.jsx(r,{value:_.default_model,onChange:e=>C({..._,default_model:e.target.value})})]}),e.jsxs("div",{children:[e.jsx(c,{children:"Schedule Hour (Sydney time)"}),e.jsx(r,{type:"number",min:"0",max:"23",value:_.schedule_hour,onChange:e=>C({..._,schedule_hour:parseInt(e.target.value)})})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",id:"enabled",checked:_.enabled,onChange:e=>C({..._,enabled:e.target.checked})}),e.jsx(c,{htmlFor:"enabled",children:"Enable Daily Cron Job"})]}),e.jsxs(l,{onClick:()=>(async e=>{try{const s=await j.blogV2.updateSettings(e);C(s),i({title:"Success",description:"Settings updated"})}catch(s){i({title:"Error",description:s.message||"Failed to update settings",variant:"destructive"})}})(_),children:[e.jsx(E,{className:"w-4 h-4 mr-2"}),"Save Settings"]})]}),e.jsx(d,{open:!!K,onOpenChange:e=>!e&&ce(),children:e.jsxs(o,{className:"max-w-4xl max-h-[90vh] overflow-y-auto",children:[e.jsx(m,{children:e.jsx(x,{children:"Edit Blog Post"})}),e.jsxs("div",{className:"space-y-6 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"edit-title",children:"Title"}),e.jsx(r,{id:"edit-title",value:X.title,onChange:e=>Y({...X,title:e.target.value}),placeholder:"Blog title"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"edit-meta-title",children:"Meta Title (SEO)"}),e.jsx(r,{id:"edit-meta-title",value:X.meta_title,onChange:e=>Y({...X,meta_title:e.target.value}),placeholder:"SEO meta title"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"edit-meta-desc",children:"Meta Description (SEO)"}),e.jsx(r,{id:"edit-meta-desc",value:X.meta_desc,onChange:e=>Y({...X,meta_desc:e.target.value}),placeholder:"SEO meta description"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"edit-keywords",children:"Keywords (comma-separated)"}),e.jsx(r,{id:"edit-keywords",value:X.keywords.join(", "),onChange:e=>Y({...X,keywords:e.target.value.split(",").map(e=>e.trim()).filter(Boolean)}),placeholder:"keyword1, keyword2, keyword3"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{children:"Content (Markdown)"}),e.jsx(M,{value:X.content_md,onChange:e=>Y({...X,content_md:e}),height:500,placeholder:"Write your blog content in markdown..."})]}),e.jsxs("div",{className:"flex gap-2 justify-end",children:[e.jsx(l,{variant:"outline",onClick:ce,disabled:ee,children:"Cancel"}),e.jsx(l,{onClick:async()=>{if(K)try{se(!0),await j.blogV2.update({blog_id:K.id,title:X.title,meta_title:X.meta_title,meta_desc:X.meta_desc,content_md:X.content_md,keywords:X.keywords}),i({title:"Success",description:"Blog updated successfully"}),ce(),await ie()}catch(e){i({title:"Error",description:e.message||"Failed to update blog",variant:"destructive"})}finally{se(!1)}},disabled:ee,children:ee?e.jsxs(e.Fragment,{children:[e.jsx(V,{className:"w-4 h-4 mr-2 animate-spin"}),"Saving..."]}):e.jsxs(e.Fragment,{children:[e.jsx(L,{className:"w-4 h-4 mr-2"}),"Save Changes"]})})]})]})]})})]}):e.jsx(n,{className:"p-6",children:e.jsx("p",{className:"text-center text-slate-600",children:"Please log in to access blog management"})})}export{q as default};
