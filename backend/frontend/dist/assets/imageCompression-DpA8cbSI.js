const e=["image/jpeg","image/jpg","image/png","image/webp"];function t(t){return e.includes(t.type.toLowerCase())}async function a(e,t){return new Promise((a,r)=>{const o=new FileReader;o.onerror=()=>r(new Error("Failed to read file")),o.onload=o=>{var n;const i=new Image;i.onerror=()=>r(new Error("Failed to load image")),i.onload=()=>{try{let{width:o,height:n}=i;t.maxWidth&&o>t.maxWidth&&(n=n*t.maxWidth/o,o=t.maxWidth),t.maxHeight&&n>t.maxHeight&&(o=o*t.maxHeight/n,n=t.maxHeight);const c=document.createElement("canvas");c.width=o,c.height=n;const d=c.getContext("2d");if(!d)return void r(new Error("Failed to get canvas context"));d.fillStyle="#FFFFFF",d.fillRect(0,0,o,n),d.drawImage(i,0,0,o,n);const l=t.outputFormat||("image/png"===e.type?"image/png":"image/jpeg"),s=t.quality/100;c.toBlob(e=>{if(!e)return void r(new Error("Failed to create blob"));const t=c.toDataURL(l,s);a({blob:e,dataUrl:t,size:e.size,width:o,height:n})},l,s)}catch(o){r(o)}},i.src=null==(n=o.target)?void 0:n.result},o.readAsDataURL(e)})}function r(e){if(0===e)return"0 Bytes";const t=Math.floor(Math.log(e)/Math.log(1024));return`${(e/Math.pow(1024,t)).toFixed(2)} ${["Bytes","KB","MB","GB"][t]}`}function o(e,t){return(e-t)/e*100}async function n(e){return new Promise((t,a)=>{const r=new FileReader;r.onload=e=>{var a;return t(null==(a=e.target)?void 0:a.result)},r.onerror=()=>a(new Error("Failed to create preview")),r.readAsDataURL(e)})}async function i(e,t){const a=URL.createObjectURL(e),r=document.createElement("a");r.href=a,r.download=t,document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(a)}function c(e,t){return`${e.replace(/\.[^/.]+$/,"")}_compressed.${t.split("/")[1]}`}export{a,o as b,n as c,i as d,r as f,c as g,t as i};
